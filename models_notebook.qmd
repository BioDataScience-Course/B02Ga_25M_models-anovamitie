---
title: "Cannibalisme chez les serpents"
author: "Louise Dubrecq, Sarah Delapierre, Martin Jadouille, Charlotte De Saeger"
format:
  html:
    code-fold: true
    code-tools: true
    toc: true
editor: visual
lang: fr
bibliography: references.bib
---

<!--# Ceci est un commentaire. -->

<!--% Ceci est une consigne. Ne jamais modifier ni déplacer les consignes dans le document ! -->

<!--% Complétez le titre et le nom des auteurs (auteur1, auteur2, auteur3 et auteur 4) dans l'entête YAML.-->

## Introduction et but

<!--% Rédigez une courte introduction de 3 ou 5 phrases qui présente vos données. Ajoutez une phrase de but (que vous remanierez éventuellement en fonction des modèles que vous ajouterez plus tard). Vous pouvez citer la bibliographie en utilisant le formatage Markdown ad hoc et en incluant votre référence au format bibtex dans le fichier references.bib. -->

Le jeu de données utilisé dans ce document est tiré d'une recherche sur le cannibalisme entre serpents [@wu2021]. Le principal point recherché est de savoir si le pattern sur les jeunes serpents influe sur l'attaque du serpent adulte ou non. En effet, des serpents adulte de l'espèce king snake et de l'espèce cornsnake ont été mis en contact avec des jeunes de chaque espèce afin de voir combien de temps s'écoulait avant l'attaque, s'il y en avait une.

## Matériel et méthodes

<!--% Indiquez ici d'où viennent les données et aussi quel logiciel (et version) vous utilisez pour les analyses. Inspirez-vous des projets du premier module de SDD II. -->

...Matériel et méthodes...

## Analyses

```{r setup, include=FALSE}
# Ceci est nécessaire pour les tests SDD, ne pas utiliser dans un "vrai" projet
if (!"tools:tests" %in% search())
  source(here::here("tests/tools_tests.R"), attach(NULL, name = "tools:tests"))
# Configure Knitr to use AGG as graphic device
knitr::opts_chunk$set(dev = "ragg_png")

# Configuration de l'environnement
SciViews::R("model")
```

<!--% Importez les données que vous aurez préalablement nettoyées, remaniées et labélisées dans le script R nommé `R/import.R`. -->

```{r import}
# Lecture des données
snakerev <- read("data/snake.rds")
# Tableau des premières et dernières lignes
tabularise$headtail(snakerev)
skimr::skim(snakerev)
```

### Description des données

<!--% Chaque étudiant réalise et interprète un graphique pertinent en lien avec le but fixé et les modèles qui seront réalisés. Graphique et interprétation de l'étudiant #1 ci-dessous. -->

```{r Louise Dubrecq chart}
chart(data = snakerev, ~ pattern %fill=% pred_attempt) +
geom_bar(position = "dodge") +
  labs(y = "Effectifs", x = "Motif de la proie du serpent", fill = "Attaque")

```

... interprétation #1...

<!--% Graphique et interprétation de l'étudiant #2 ci-dessous. -->

```{r chart2}
chart(data = snakerev,  ~ prey_species %col=% adult_sex ) +
  geom_bar(position = "dodge") +
  labs(x = "Espèce", y = "Effectif", col = "Sexe", title = "Dénombrement du nombre de proie par espèce et par sexe") + 
  geom_text(
    stat = "count",
    aes(label = after_stat(count)),
    position = position_dodge(width = 0.9),
    vjust = -0.5  )
```

... interprétation #2...

<!--% Graphique et interprétation de l'étudiant #3 ci-dessous. -->

```{r chart3}
chart(data = snakerev, juvenile_mass_g ~ time_to_attack_s %col=% prey_species) +
  geom_point() +
  labs(x = "Temps avant l'attaque [s]", y = "Masse du juvénile [g]", col = "Espèce")

chart(data=snakerev, adult_svl_cm ~time_to_attack_s %col=% adult_sex) +
  geom_point() +
  labs(x = "Temps avant l'attaque [s]", y = "Taille de l'adulte [cm]", col = "Espèce")

```

-   La masse des juvéniles n'influence pas le temps d'attaque.

-   L'espèce "cornsnake" se fait presque toujours attaqué comparé à l'espèce "kingsnake".

<!--% Graphique et interprétation de l'étudiant #4 ci-dessous. -->

```{r chart4}
chart(data=snakerev, juvenile_svl_cm ~time_to_attack_s %col=% juvenile_sex) +
  geom_point() +
  labs(x = "Temps avant l'attaque [s]", y = "Taille de l'adulte [cm]", col = "Espèce")
chart(data =snakerev, experiment ~ time_to_attack_s %col=% prey_species) + 
  geom_point()
```

... interprétation #4...

### Modélisation

<!--% Chaque modèle doit être décrit à l'aide d'un graphique et d'un tableau résumant le modèle. Les équations paramétrées de tous les modèles doivent être également présentes. L'analyse des résidus sera réalisée et interprétée pour chaque modèle. -->

<!--% Ajustez une régression linéaire simple, multiple ou polynomiale par paire d'étudiants dans cette section (donc, deux modèles pour l'équipe de quatre). -->

#### Régression linéaire 1

```{r rég linéaire 1}

#Création d'une nouvelle variable
snakerev <- snakerev %>%
  smutate(
    ratio_mass = adult_mass_g / juvenile_mass_g,
    ratio_svl = adult_svl_cm / juvenile_svl_cm
  )
snakerev <- labelise(snakerev, 
  label = list(
    ratio_mass = "Rapport entre la masse de l'adulte et du juvénile",
    ratio_svl = "Rapport entre la taille de l'adulte et du juvénile"), 
  units=list(
      ratio_mass = "NA",
    ratio_svl = "NA"
  ))

#On vire ceux qui n'attaque pas car pas intéressant
snake_only_attaque <- snakerev %>%
  filter(time_to_attack_s < 900)


#Détermination des variables à utiliser
snakerev_corr <- correlation(sselect(snake_only_attaque, ratio_mass, ratio_svl, adult_mass_g, adult_svl_cm, juvenile_mass_g, juvenile_svl_cm, time_to_attack_s) )

plot(snakerev_corr)


#2 régression intéressante
snakerev_lm1 <- lm(data = snake_only_attaque, time_to_attack_s ~ ratio_mass)
tabularise(summary_(snakerev_lm1))

snakerev_lm1.2 <- lm(data = snake_only_attaque, time_to_attack_s ~ ratio_mass + ratio_svl)
tabularise(summary_(snakerev_lm1.2))

chart(snakerev_lm1)
chart$residuals(snakerev_lm1)

```

$$
`r eq__(snakerev_lm1.2, use_coefs = TRUE)`
$$
<<<<<<< HEAD

Mettre que c'est pas pertinent et pourquoi est ce qu'on a tester ça ( genre truc biologique les grand attaque les grands...)
=======
>>>>>>> a5f22202ed64425d4f18ef5c5066bb2730437b6d

#### Régression linéaire 2

```{r reg linéaire 2}
#modèle polynomial inutile
snakerev_lm2 <- lm(data = snakerev, adult_mass_g ~ adult_svl_cm)
tabularise(summary_(snakerev_lm2))
chart(snakerev_lm2)
#quand log(adult_mass_g ), indiquer , origdata = snakerev si chart() ne trouve plus une de mes variables car il ne trouve pas log(variable), origdata reprécise où regarder les données
chart$residuals(snakerev_lm2)
```

$$
`r eq__(snakerev_lm2, use_coefs = TRUE, origdata = snakerev)`
$$

L'interprétation du tableau récapitulatif du modèle linéaire nous indique que le modèle est très ajusté avec un R\^2 = 0.98 et qu'il est significatif. (F-stat : 8735 on 1 and 198 df - p value : \<2.22e-16). L'ordonnée à l'origine est significativement différente de 0, par contre, il est faiblement estimée avec un rapport de \~1/6 entre l'écart type et la valeur estimée. La pente est significativement différent de 0 et est estimé avec bonne précision.

Une analyse visuelle nous informe que la courbe de la régression linéaire ne s'ajuste pas bien dans les données. L'enveloppe de confiance à 95% est étroite et le modèle est estimé avec une précision non acceptable, aucun point n'est recouvert par l'enveloppe.

Ce contraste s'explique par une analyse des résidus très mauvaise. En effet, bien que l'étendue des résidus soit acceptable, il n'y pas linéarité, ni normalité des résidus, ni homoscédasticité. La variance augmente vers 64 en raison de l'influence d'un effet de levier et augmente aussi pour les plus grandes valeurs à cause d'un point ayant une forte distance de cook. Les conditions de linéarité, d'homoscédasticité et de normalité des résidus n'étant pas respectées, le modèle n'est pas valide.

Le modèle a été revu plusieurs fois mais aucun des essais n'a été concluant.

<!--% Ajustez une régression linéaire simple, multiple ou polynomiale par paire d'étudiants dans cette section (donc, deux modèles pour l'équipe de quatre). -->

#### Modèle linéaire 1

```{r modèle linéaire 1}
snake_mod1_lm <- lm(data = snakerev, time_to_attack_s ~ pattern + pred_attempt )
summary(snake_mod1_lm) |>tabularise()
```

$$
`r eq__(snake_mod1_lm, use_coefs = TRUE, origdata = snakerev)`
$$

<!--% Construisez un modèle linéaire par paire d'étudiants dans cette section. -->

#### Modèle linéaire 2

```{r modèle linéaire 2}
snakerev_lm4 <- lm(data = snakerev, time_to_attack_s ~ painted + pred_attempt)
tabularise(summary_(snakerev_lm4))
```

$$
`r eq__(snakerev_lm4, use_coefs = TRUE, origdata = snakerev)`
$$

<!--% Construisez un modèle linéaire par paire d'étudiants dans cette section. -->

#### Modèle linéaire généralisé et/ou mixte 1

<!--% Élaborez un modèle linéaire généralisé ou mixte par paire d'étudiants dans cette section. -->

```{r}
snake_mod1_gen <- glm(data = snakerev, ratio_mass ~ prey_species, family = gaussian)
summary(snake_mod1_gen) |>tabularise()
```

#### Modèle linéaire généralisé et/ou mixte 2

<!--% Élaborez un modèle linéaire généralisé ou mixte par paire d'étudiants dans cette section. -->

```{r glm 2}
glm2 <- glm(data = snakerev, pred_attempt_bin ~ pattern + prey_species, family = binomial)
tabularise(summary(glm2))
```

$$
`r eq__(glm2, use_coefs = TRUE, origdata = snakerev)`
$$

## Conclusion

<!--% Lorsque toutes les analyses sont réalisées, terminez ce bloc-notes avec 3 à 6 phrases de conclusion en rapport avec ce que vous avez observé dans vos analyses. Quels sont les modèles les plus pertinents que vous retenez ? -->

...vos conclusions ici...

## Références

<!--% N'indiquez rien ci-dessous. Quarto se chargera de rajouter vos références bibliographiques automatiquement. -->
