---
title: "Cannibalisme chez les serpents"
author: "Louise Dubrecq, Sarah Delapierre, Martin Jadouille, Charlotte De Saeger"
format:
  html:
    code-fold: true
    code-tools: true
    toc: true
editor: visual
lang: fr
bibliography: references.bib
---

<!--# Ceci est un commentaire. -->

<!--% Ceci est une consigne. Ne jamais modifier ni déplacer les consignes dans le document ! -->

<!--% Complétez le titre et le nom des auteurs (auteur1, auteur2, auteur3 et auteur 4) dans l'entête YAML.-->

## Introduction et but

<!--% Rédigez une courte introduction de 3 ou 5 phrases qui présente vos données. Ajoutez une phrase de but (que vous remanierez éventuellement en fonction des modèles que vous ajouterez plus tard). Vous pouvez citer la bibliographie en utilisant le formatage Markdown ad hoc et en incluant votre référence au format bibtex dans le fichier references.bib. -->

Le jeu de données utilisé dans ce document est tiré d'une recherche sur le cannibalisme entre serpents [@wu2021]. Les espèces de serpent rencontrées dans ce document, les *kingsnakes* et les *cornsnakes*, sont des serpents carnivores et notamment cannibales. Ces deux espèces de serpent possèdent des patterns différents sur leurs corps. Leur alimentation se compose en partie d'autres serpents, et en partie d'insectes et de petits rongeurs. Ces serpents vivent dans des prairies ou clairières d'Amérique du nord.

Le principal point recherché est de savoir si la morphologie ou le pattern des jeunes serpents influe sur l'attaque du serpent adulte ou non. En effet, des serpents adultes de l'espèce *kingsnake* et de l'espèce *cornsnake* ont été mis en contact avec des jeunes de chaque espèce afin de voir combien de temps s'écoulait avant l'attaque, s'il y en avait une.

## Matériel et méthodes

<!--% Indiquez ici d'où viennent les données et aussi quel logiciel (et version) vous utilisez pour les analyses. Inspirez-vous des projets du premier module de SDD II. -->

Les données ont été collectées par *Wu Nicholas* *et al* et sont en accès libre (MIT Licence, <https://doi.org/10.5281/zenodo.5399271>)**.** Toutes les informations sur les données, le déroulé des expériences et le dictionnaire des données sont disponibles dans l'article.

Différentes régressions linéaires et modèles linéaires sont utilisés afin de modéliser les données. Au préalable, une description des données est réalisée pour les représenter. Le seuil $\alpha$ de tous les tests est fixé à l'avance à 5%.

L'analyse est réalisée avec le logiciel R (`r R.version.string`) et en particulier le package {modelit} version `r packageVersion("modelit")` avec la [SciViews Box 2025](https://www.sciviews.org/software/svbox/) dans [Saturn Cloud](https://saturncloud.io/) (Linux Ubuntu 22.04).

## Analyses

```{r setup, include=FALSE}
# Ceci est nécessaire pour les tests SDD, ne pas utiliser dans un "vrai" projet
if (!"tools:tests" %in% search())
  source(here::here("tests/tools_tests.R"), attach(NULL, name = "tools:tests"))
# Configure Knitr to use AGG as graphic device
knitr::opts_chunk$set(dev = "ragg_png")

# Configuration de l'environnement
SciViews::R("model")
```

<!--% Importez les données que vous aurez préalablement nettoyées, remaniées et labélisées dans le script R nommé `R/import.R`. -->

```{r import}
# Lecture des données
snakerev <- read("data/snake.rds")
# Tableau des premières et dernières lignes
tabularise$headtail(snakerev)
skimr::skim(snakerev)
snakerev<-smutate(snakerev, juvenile_sex = as.factor(juvenile_sex), pattern = as.factor(pattern), painted = as.factor(painted), pred_attempt = as.factor(pred_attempt), prey_species = as.factor(prey_species), adult_sex  = as.factor(adult_sex)
)
```

### Description des données

<!--% Chaque étudiant réalise et interprète un graphique pertinent en lien avec le but fixé et les modèles qui seront réalisés. Graphique et interprétation de l'étudiant #1 ci-dessous. -->

```{r Louise Dubrecq chart}
chart(data = snakerev, ~ pattern %fill=% pred_attempt) +
geom_bar(position = "dodge") +
  labs(y = "Effectifs", x = "Motif de la proie du serpent", fill = "Attaque") +
    geom_text(stat = "count", aes(label = ..count..), position = position_dodge(width = 0.9), vjust = -0.2)

```

-   Lorsque la proie arbore un pattern normal, le pourcentage d’attaque du serpent prédateur est de 9,8%. Pour le « painted » , il est de 60%, 48% pour une proie peinte de manière aléatoire et 76% pour ceux n’ayant pas de motif.
-   Le taux d’attaque est plus haut quand la proie n’a pas de motif. En outre, lorsque la proie a un pattern normal, il est au plus bas.
-   Les proies peintes de manière aléatoire et celle avec un motif normal sont les 2 ou la non-attaque l’emporte sur l’attaque

<!--% Graphique et interprétation de l'étudiant #2 ci-dessous. -->

```{r chart2}
chart(data = snakerev,  ~ prey_species %col=% adult_sex ) +
  geom_bar(position = "dodge") +
  labs(x = "Espèce", y = "Effectif", col = "Sexe", title = "Dénombrement du nombre de proie par espèce et par sexe") + 
  geom_text(
    stat = "count",
    aes(label = after_stat(count)),
    position = position_dodge(width = 0.9),
    vjust = -0.5  )
```

Il y a plus d'individus de l'espèce "Kingsnake" que de l'espèce "Corn snake". Il y a plus de mâle (40) que de femelle (29) chez cette dernière espèce tandis que pour l'espèce "Kingsnake", il y a plus de femelles (66) que de mâles (65). Cependant, cette différence est très faible (à 1 individu près).

<!--% Graphique et interprétation de l'étudiant #3 ci-dessous. -->

```{r chart3}

chart(data = snakerev, juvenile_mass_g ~ time_to_attack_s %col=% prey_species) +
  geom_point() +
  labs(x = "Temps avant l'attaque [s]", y = "Masse du juvénile [g]", col = "Espèce")





a<-chart(data = snakerev,  ~ adult_ID ) +
  geom_bar(position = "dodge")+
  coord_flip()+
  labs(x = "ID de l'adulte", y = "Nombre d'observations")
b<- chart(data = snakerev,  ~ juvenile_ID) +
  geom_bar(position = "dodge", width = 0.9)+
  coord_flip()+
  labs(x = "ID du juvénile", y = "Nombre d'observations")
combine_charts(list(a,b))
```

-   La masse des juvéniles n'influence pas le temps d'attaque.

-   Les juvéniles de l'espèce *kingsnake* ont tous une masse supérieur à celle de l'espèce *cornsnake*.

-   On peut observer qu'il y a indépendance des observations lors des expérience parce que certains juvéniles et tout les adultes sont repris plusieurs fois.

<!--% Graphique et interprétation de l'étudiant #4 ci-dessous. -->

```{r chart4}
chart(data =snakerev, experiment ~ time_to_attack_s %col=% prey_species) + 
  geom_point(alpha = 0.5) +
  labs(x = "Temps avant l'attaque [s]", y = "Taille de l'adulte [cm]", col = "Espèce")
```

Par transparence, nous pouvons voir que les jeunes serpents de l'espèce kingsnake, des expériences 1 à 4, n'ont un grand taux d'attaque que lorsque le jeune ne présente aucun pattern.

Dans les expériences 5 et 6, avec des jeunes serpents de l'espèce cornsnake, nous pouvons voir que le serpent adulte attaque beaucoup plus rapidement les serpents non peints que les serpents peints.

En comparant les deux types d'expérience entre eux, nous pouvons observer que les serpents sans pattern et les serpents cornsnake sont attaqués beaucoup plus rapidement que les autres serpents.

### Modélisation

<!--% Chaque modèle doit être décrit à l'aide d'un graphique et d'un tableau résumant le modèle. Les équations paramétrées de tous les modèles doivent être également présentes. L'analyse des résidus sera réalisée et interprétée pour chaque modèle. -->

<!--% Ajustez une régression linéaire simple, multiple ou polynomiale par paire d'étudiants dans cette section (donc, deux modèles pour l'équipe de quatre). -->

#### Régression linéaire 1

```{r rég linéaire 1}

#Création d'une nouvelle variable
snakerev <- snakerev %>%
  smutate(
    ratio_mass = adult_mass_g / juvenile_mass_g,
    ratio_svl = adult_svl_cm / juvenile_svl_cm
  )
snakerev <- labelise(snakerev, 
  label = list(
    ratio_mass = "Rapport entre la masse de l'adulte et du juvénile",
    ratio_svl = "Rapport entre la taille de l'adulte et du juvénile"), 
  units=list(
      ratio_mass = "NA",
    ratio_svl = "NA"
  ))

#On vire ceux qui n'attaquent pas car pas intéressant
snake_only_attaque <- snakerev %>%
  filter(time_to_attack_s < 900)


#Détermination des variables à utiliser
snakerev_corr <- correlation(sselect(snake_only_attaque, ratio_mass, ratio_svl, adult_mass_g, adult_svl_cm, juvenile_mass_g, juvenile_svl_cm, time_to_attack_s) )

plot(snakerev_corr)


#2 régression intéressante
snakerev_lm1 <- lm(data = snake_only_attaque, time_to_attack_s ~ ratio_mass)
tabularise(summary_(snakerev_lm1))

snakerev_lm1.2 <- lm(data = snake_only_attaque, time_to_attack_s ~ ratio_mass + ratio_svl)
tabularise(summary_(snakerev_lm1.2))

chart(snakerev_lm1)
chart$residuals(snakerev_lm1)

```

$$
`r eq__(snakerev_lm1.2, use_coefs = TRUE)`
$$

Le modèle réalisé n'est pas significatif et pertinent. Seul l'ordonnée à l'origine est significative au seuil alpha de 5%. De plus, le R² est proche de 0 ce qui indique que notre modèle n'est pas bien ajusté.

La visualisation graphique du modèle montre que les points ne sont pas compris dans l'intervalle de confiance, ce qui indique que le modèle n'est pas ajusté de façon acceptable.

L'analyse du graphique composite des résidus nous indique que la normalité des résidus ne suit pas une distribution normale car les résidus s'écarte de manière symétrique aux extrémités. Les résidus sont élevé par rapport aux valeurs prédites. Les points sembla avoir une distance de Cook relativement élevé par contre l'homoscédasticité est respectée.

Ce test a été réalisé car nous pensions qu'il ya aurait une relation entre le temps d'attaque et la relation entre la masse de l'adulte et du juvénile. Pour nous, les adultes de grande taille ciblent des juvéniles proportionnellement plus grands.

<!--% Ajustez une régression linéaire simple, multiple ou polynomiale par paire d'étudiants dans cette section (donc, deux modèles pour l'équipe de quatre). -->

#### Régression linéaire 2

```{r reg linéaire 2}
#modèle polynomial inutile
snakerev_lm2 <- lm(data = snakerev, adult_mass_g ~ adult_svl_cm)
tabularise(summary_(snakerev_lm2))
chart(snakerev_lm2)
#quand log(adult_mass_g ), indiquer , origdata = snakerev si chart() ne trouve plus une de mes variables car il ne trouve pas log(variable), origdata reprécise où regarder les données
chart$residuals(snakerev_lm2)
```

$$
`r eq__(snakerev_lm2, use_coefs = TRUE, origdata = snakerev)`
$$

L'interprétation du tableau récapitulatif du modèle linéaire nous indique que le modèle est très ajusté avec un R\^2 = 0.98 et qu'il est significatif. (F-stat : 8735 on 1 and 198 df - p value : \<2.22e-16). L'ordonnée à l'origine est significativement différente de 0, par contre, il est faiblement estimée avec un rapport de \~1/6 entre l'écart type et la valeur estimée. La pente est significativement différent de 0 et est estimé avec bonne précision.

Une analyse visuelle nous informe que la courbe de la régression linéaire ne s'ajuste pas bien dans les données. L'enveloppe de confiance à 95% est étroite et le modèle est estimé avec une précision non acceptable, aucun point n'est recouvert par l'enveloppe.

Ce contraste s'explique par une analyse des résidus très mauvaise. En effet, bien que l'étendue des résidus soit acceptable, il n'y pas linéarité, ni normalité des résidus, ni homoscédasticité. La variance augmente vers 64 en raison de l'influence d'un effet de levier et augmente aussi pour les plus grandes valeurs à cause d'un point ayant une forte distance de cook. Les conditions de linéarité, d'homoscédasticité et de normalité des résidus n'étant pas respectées, le modèle n'est pas valide.

Le modèle a été revu plusieurs fois mais aucun des essais n'a été concluant.

<!--% Construisez un modèle linéaire par paire d'étudiants dans cette section. -->

#### Modèle linéaire 1

```{r modèle linéaire 1}
snake_mod1_lm <- lm(data = snakerev, time_to_attack_s ~ pattern * prey_species, subset = time_to_attack_s < 900)
summary(snake_mod1_lm) |>tabularise()
chart$residuals(snake_mod1_lm)
```

$$
`r eq__(snake_mod1_lm, use_coefs = TRUE, origdata = snakerev)`
$$

-   Le modèle explique \~ 42% de la variance du temps d’attaque. Cette valeur est suffisante pour des données comportementales.
-   La significativité globale est haute : p = 9.27e-12.
-   Le temps moyen d’attaque pour une proie « corn snake » peinte est de 263,5 secondes (modèle de référence).
-   Les effets du Pattern : *Le pattern « painted » n’a pas d’effet significatif au seuil alpha de 5%.* L’effet du pattern « painted random » sur le temps d’attaque est significatif au seuil alpha de 5%. Ces proies sont attaquées 186 secondes plus tôt que les « painted ». \*Également le manque de pattern a un effet très significatif au seuil alpha de 5% avec une attaque moyenne 219 secondes plus tôt que celle de référence.
-   Les effets de l’espèce de proie : il n’y a pas d’effet significatif de l’espèce de la proie sur le temps d’attaque au seuil alpha de 5%
-   Les effets de l’interaction entre le motif et l’espèce : L’effet du motif « Painted » sur le temps d’attaque est significativement au seuil alpha de 5% différent selon l’espèce de la proie. Lorsque la proie est peinte et est un kingsnake, elle est attaquée plus vite que dans le cas de référence.

#### Modèle linéaire 2

```{r modèle linéaire 2}
snakerev_lm4 <- lm(data = snakerev, time_to_attack_s ~ prey_species + painted)

tabularise(summary_(snakerev_lm4))
chart$residuals(snakerev_lm4)
```

$$
`r eq__(snakerev_lm4, use_coefs = TRUE, origdata = snakerev)`
$$

-   Le modèle en lui-même est significatif au seuil alpha de 5% (p\<2.22e-16). Son R2 est de 0.3567, ce qui rend le premier modèle meilleur que celui-ci, même si ces deux modèles n'ont pas un R2 exceptionnel.

-   Toutes les variables sont significatives au seuil alpha de 5%, sauf la relation entre le fait d'être peint et le temps avant l'attaque. Néanmoins, il est très proche de l'être. Cette observation nous indique que suivant d'autres interactions, la variable "peint" pourrait être significative et être tenue en compte.

-   Dans ce modèle, la variable "espèce de la proie" est significative au seuil alpha de 5%, ce qui pourrait indiquer que le premier modèle possède légèrement trop de variables et que le calcul de la significativité des premières variables n'est pas tout à fait exact.

-   De plus, le graphique de l'analyse des résidus n'a pas énormément de sens étant donné que l'on travaille avec des données qualitatives dans ce cas.

<!--% Élaborez un modèle linéaire généralisé ou mixte par paire d'étudiants dans cette section. -->

#### Modèle linéaire généralisé et/ou mixte 1

```{r}

snake_mod1_gen <- glm(data = snakerev, pred_attempt_bin ~ ratio_mass + ratio_svl + 0, family = binomial)
summary(snake_mod1_gen) |>tabularise()
```

$$
`r eq__(snake_mod1_gen, use_coefs = TRUE)`
$$

-   Le coefficient du ratio_mass est positif : un ratio de masse plus élevé semble favoriser la présence d’une attaque. De plus, la p-value est extrêmement faible, l’effet du ratio des masses sur la présence ou non d’une attaque est hautement significatif au seuil alpha de 5%.
-   Le coefficient du ratio_svl est négatif : plus il y a un grand ratio, moins les serpents prédateurs attaquent. L’effet du ratio des tailles sur la présence ou non d’attaques est significatif au seuil alpha de 5%.
-   L’ajustement du modèle est relativement bon, mais le paramètre de dispersion montre un léger sous-ajustement.

#### Modèle linéaire généralisé et/ou mixte 2

```{r glm 2}
glm2 <- glm(data = snakerev, pred_attempt_bin ~ pattern + prey_species, family = binomial)
tabularise(summary(glm2))

```

$$
`r eq__(glm2, use_coefs = TRUE, origdata = snakerev)`
$$

Dans le cas d'un modèle linéaire généralisé mixte utilisant une famille binomiale, l'analyse des résidus n'est pas réalisée, cependant, nous pouvons dire que la dispersion est de 154.1/195 = 0.78, ce qui est acceptable. Tous les termes du modèle sont significativement différents du pattern normal au seuil alpha de 5% sauf le terme relatif aux serpents qui ont (déjà) des motifs et qui ont été peints. L'estimation des paramètres est mauvaise pour ceux qui ont déja un pattern et ont été peints, en effet, l'écart type est très élevé par rapport à la valeur estimée (0.69/0.74). Les autres variables sont estimées avec une précision très moyenne à faible. Lorsque le juvénile a des patterns et est peint aléatoirement ou lorsqu'il a des patterns mais n'a pas été peint la probabilité d'être attaqué augmente. De plus, un juvénile de l'espèce kingsnake est comparativement moins attaqué qu'un juvénile de l'espèce cornsnake.

## Conclusion

<!--% Lorsque toutes les analyses sont réalisées, terminez ce bloc-notes avec 3 à 6 phrases de conclusion en rapport avec ce que vous avez observé dans vos analyses. Quels sont les modèles les plus pertinents que vous retenez ? -->

...vos conclusions ici...

## Références

<!--% N'indiquez rien ci-dessous. Quarto se chargera de rajouter vos références bibliographiques automatiquement. -->
